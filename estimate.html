<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Estimate | Raj Marketing Mysore</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --sky: #e3f2fd;
      --sky-mid: #90caf9;
      --sky-dark: #1976d2;
      --blue: #2196f3;
      --blue-dark: #17304B;
      --white: #fff;
      --shadow: 0 2px 16px 0 rgba(25,118,210,0.10);
      --shadow-card: 0 4px 24px 0 rgba(33,150,243,0.13);
      --green: #18c964;
      --gray: #f6f8fa;
    }
    body {
      background: linear-gradient(135deg, var(--sky) 0%, var(--blue) 100%);
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
      margin: 0;
      color: var(--blue-dark);
      padding: 0;
    }
    header {
      width: 100vw;
      background: var(--blue-dark);
      color: var(--white);
      position: sticky;
      top: 0;
      left: 0;
      z-index: 20;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.9rem 1.2rem;
      font-size: 1.14rem;
      font-weight: 600;
      letter-spacing: 1px;
    }
    .header-title {
      font-size: 1.13rem;
      font-weight: 700;
      letter-spacing: 1px;
      color: var(--white);
    }
    .menu-btn {
      background: none;
      border: none;
      color: var(--white);
      font-size: 2.1rem;
      cursor: pointer;
      outline: none;
      padding: 2px 4px;
      border-radius: 5px;
      margin-left: 10px;
      transition: background 0.15s;
    }
    .menu-btn:active, .menu-btn:focus {
      background: var(--sky-mid);
      color: var(--blue-dark);
    }
    nav.topnav {
      position: fixed;
      top: 56px;
      right: 0;
      background: var(--blue-dark);
      border-radius: 0 0 0 16px;
      box-shadow: var(--shadow-card);
      padding: 1.1rem 1.4rem 1.1rem 1.8rem;
      z-index: 99;
      display: none;
      flex-direction: column;
      gap: 1.1rem;
      min-width: 150px;
      animation: fadeIn .25s;
    }
    nav.topnav.open {
      display: flex;
    }
    nav.topnav a {
      color: var(--white);
      text-decoration: none;
      font-weight: 500;
      padding: 0.24em 0.7em;
      border-radius: 6px;
      font-size: 1.09rem;
      transition: background .18s, color .18s;
      letter-spacing: .3px;
    }
    nav.topnav a:hover, nav.topnav a.active {
      background: var(--sky-mid);
      color: var(--blue-dark);
    }
    @media (max-width: 480px) {
      header { padding: 0.8rem 0.7rem; font-size: 1rem; }
      .header-title { font-size: 1.01rem; }
      nav.topnav { padding: 1rem 0.8rem 1rem 1.2rem; min-width: 110px; }
    }
    .container {
      max-width: 700px;
      margin: 32px auto 0 auto;
      padding: 24px 0 80px 0;
    }
    .business-block {
      text-align: center;
      margin-bottom: 18px;
      background: rgba(255,255,255,0.98);
      border-radius: 18px;
      padding: 16px 0 10px 0;
      box-shadow: var(--shadow-card);
    }
    .business-name {
      font-size: 1.31rem;
      font-weight: 800;
      color: var(--blue-dark);
      letter-spacing: 0.5px;
      margin-bottom: 2px;
    }
    .business-details {
      font-size: 1.08rem;
      color: var(--blue);
      font-weight: 500;
      margin-bottom: 3px;
    }
    .business-address {
      color: #1976d2;
      font-size: 1.01rem;
      font-weight: 500;
      letter-spacing: 0.2px;
      margin-bottom: 2px;
    }

    h2 {
      text-align: center;
      color: var(--blue-dark);
      margin-bottom: 24px;
      font-size: 1.34rem;
      font-weight: 700;
      letter-spacing: 1px;
      text-shadow: 0 3px 30px #fff, 0 1px 8px var(--sky-mid);
    }
    form.estimate-form {
      background: var(--white);
      padding: 22px 18px 18px 18px;
      border-radius: 16px;
      box-shadow: var(--shadow-card);
      max-width: 99vw;
      margin: auto;
      margin-bottom: 26px;
      position: relative;
    }
    .form-head-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      flex-wrap: wrap;
      gap: 0 8px;
    }
    .estimate-id {
      font-size: 1.08rem;
      font-weight: 700;
      color: var(--blue);
      letter-spacing: 0.7px;
      background: var(--sky-mid);
      padding: 6px 18px;
      border-radius: 9px;
      box-shadow: 0 1px 10px 0 var(--sky-mid);
      margin-bottom: 0.5em;
    }
    .form-row-flex {
      display: flex;
      gap: 14px;
      margin-bottom: 5px;
    }
    .form-row-flex > div {
      flex: 1 1 0;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: 600;
      color: var(--blue-dark);
      letter-spacing: .4px;
      font-size: 1.03rem;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1.3px solid var(--sky-mid);
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      background: var(--gray);
      margin-bottom: 2px;
      color: var(--blue-dark);
      outline: none;
      font-weight: 500;
      transition: border .13s;
    }
    input:focus, select:focus {
      border-color: var(--blue-dark);
      background: #fff;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      background: var(--gray);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    table, th, td {
      border: 1px solid #cbdff5;
    }
    th {
      background-color: var(--sky-mid);
      color: var(--blue-dark);
      font-weight: 600;
      font-size: 1.01rem;
    }
    th, td {
      padding: 10px;
      text-align: center;
      font-size: 0.99rem;
    }
    .btn {
      margin-top: 22px;
      padding: 12px 25px;
      background: linear-gradient(90deg, var(--sky-mid) 0%, var(--blue) 100%);
      color: var(--blue-dark);
      border: none;
      font-size: 1.13rem;
      font-weight: 700;
      border-radius: 10px;
      cursor: pointer;
      width: 100%;
      transition: background .15s, color .15s;
      box-shadow: 0 2px 8px 0 rgba(25,118,210,0.13);
      letter-spacing: .2px;
    }
    .btn:hover {
      background: var(--blue-dark);
      color: var(--white);
    }
    .total {
      margin-top: 23px;
      font-size: 1.07rem;
      font-weight: 700;
      color: var(--green);
      line-height: 1.8;
      background: #e9fff2;
      padding: 16px 15px;
      border-radius: 10px;
      box-shadow: var(--shadow-card);
      letter-spacing: .3px;
    }
    .download-btn {
      margin-top: 18px;
      background: #1976d2;
      color: #fff;
      border: none;
      padding: 11px 26px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1.09rem;
      cursor: pointer;
      transition: background .13s;
      display: block;
      width: 100%;
    }
    .download-btn:hover {
      background: #17304B;
      color: #fff;
    }
    .preview-block {
      background: var(--white);
      margin-top: 32px;
      border-radius: 16px;
      box-shadow: var(--shadow-card);
      padding: 32px 22px 36px 22px;
      font-size: 1.07rem;
      color: var(--blue-dark);
      max-width: 99vw;
      margin-bottom: 22px;
      position: relative;
      overflow-x: auto;
      animation: fadeIn .7s;
    }
    .preview-title {
      text-align: center;
      font-size: 1.21rem;
      font-weight: 700;
      color: var(--blue-dark);
      margin-bottom: 10px;
      letter-spacing: .8px;
    }
    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      background: var(--sky-mid);
      padding: 15px 10px 10px 10px;
      border-radius: 12px;
      box-shadow: 0 1px 8px 0 var(--sky-mid);
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 8px 15px;
    }
    .preview-details {
      border-radius: 11px;
      background: var(--gray);
      padding: 8px 15px;
      margin-bottom: 0;
      font-size: 1.01rem;
      color: var(--blue-dark);
      line-height: 1.45;
      box-shadow: 0 1px 8px 0 var(--sky-mid);
      font-weight: 500;
      letter-spacing: .2px;
    }
    .signatory {
      margin-top: 32px;
      text-align: right;
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--blue-dark);
    }
    .stamp {
      width: 98px;
      opacity: 0.93;
      margin-bottom: 2px;
      margin-right: 6px;
      vertical-align: middle;
    }
    /* Responsive */
    @media (max-width: 680px) {
      .container { max-width: 99vw; padding: 10px 0 40px 0; }
      h2 { font-size: 1.09rem;}
      .preview-block { font-size: 0.97rem; padding: 18px 7px 23px 7px;}
      .signatory { font-size: 1rem;}
      .preview-header { flex-direction: column; align-items: stretch;}
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(18px);}
      to { opacity: 1; transform: translateY(0);}
    }
    /* Footer - copy from about page */
    footer {
      background: var(--blue-dark);
      color: var(--white);
      padding: 30px 0 16px 0;
      text-align: center;
      font-size: 0.98rem;
      border-top: 2px solid var(--sky-mid);
      margin-top: 2.2rem;
    }
    .footer-links {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 15px 22px;
      margin-bottom: 17px;
    }
    .footer-link {
      color: var(--sky-mid);
      text-decoration: underline;
      font-weight: 500;
      transition: color 0.15s;
    }
    .footer-link:hover {
      color: var(--white);
      text-decoration: none;
    }
    .whatsapp-btn {
      background: #25D366;
      color: #fff;
      padding: 7px 14px 7px 12px;
      border-radius: 8px;
      font-weight: 600;
      margin-right: 8px;
      text-decoration: none;
      transition: background 0.18s;
      display: inline-block;
      margin-bottom: 6px;
    }
    .whatsapp-btn:hover { background: #128c7e; color:#fff;}
    .email-btn {
      background: var(--sky-mid);
      color: var(--blue-dark);
      padding: 7px 13px;
      border-radius: 8px;
      font-weight: 600;
      text-decoration: none;
      transition: background 0.18s;
      display: inline-block;
      margin-bottom: 6px;
    }
    .email-btn:hover { background: var(--blue-dark); color: var(--white);}
    .print-preview header, .print-preview form.estimate-form, .print-preview .btn, .print-preview footer {
      display: none !important;
    }
    @media print {
      header, form.estimate-form, .btn, footer {
        display: none !important;
      }
      .print-preview {
        box-shadow: none !important;
        border-radius: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-title">Raj Marketing Mysore</div>
    <button class="menu-btn" id="menuBtn" aria-label="Menu">&#9776;</button>
    <nav class="topnav" id="topNav">
      <a href="index.html">Home</a>
      <a href="products.html">Products</a>
      <a href="services.html">Services</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a href="admin.html">Admin</a>
    </nav>
  </header>
  <div class="container">
    <div class="business-block">
      <div class="business-name">Raj Marketing Mysore</div>
      <div class="business-details">+91 94830 37385</div>
      <div class="business-address">#84, Nrupatunga Road, Kuvempu Nagar, Mysore, Karnataka, India</div>
    </div>
    <form class="estimate-form" id="estimateForm" autocomplete="off">
      <div class="form-head-row">
        <div class="estimate-id" id="estimateIdBox"></div>
        <div style="text-align:right;">
          <label style="margin-top:0;">Date:</label>
          <input type="date" id="date" required style="margin-top:4px;">
          <label style="margin-top:8px;">Customer ID:</label>
          <input type="text" id="customerId" readonly style="background:#e3f2fd;font-weight:700;">
        </div>
      </div>
      <label for="customerName" style="margin-top:14px;">Customer Name:</label>
      <input type="text" id="customerName" required maxlength="60" />

      <label for="mobileNumber">Mobile Number:</label>
      <input type="tel" id="mobileNumber" required pattern="[0-9+\s]{8,16}" maxlength="16"/>

      <label for="address">Address:</label>
      <input type="text" id="address" required maxlength="100" />

      <div class="form-row-flex">
        <div>
          <label for="netType">Type of Product:</label>
          <select id="netType" required>
            <option value="">Select</option>
            <option value="Velcro System">Velcro System</option>
            <option value="Frame System">Frame System</option>
            <option value="Pleated Nets">Pleated Nets</option>
            <option value="Fly Mesh Door">Fly Mesh Door</option>
          </select>
        </div>
        <div>
          <label for="pricePerSqft">Price per Sqft (₹):</label>
          <input type="number" id="pricePerSqft" min="1" readonly required />
        </div>
      </div>
      <label>Items:</label>
      <table id="itemsTable">
        <thead>
          <tr>
            <th>Width (inches)</th>
            <th>Height (inches)</th>
            <th>Quantity</th>
            <th>Total Sqft</th>
            <th>Price (₹)</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <!-- JS populates rows -->
        </tbody>
      </table>
      <button type="button" class="btn" id="addRowBtn">Add Row</button>
      <div class="total" id="totals"></div>
      <button type="button" class="btn" id="genPreviewBtn">Preview Estimate</button>
    </form>
    <div class="preview-block" id="previewBlock" style="display:none;">
      <div class="preview-title">Estimate</div>
      <div class="preview-header">
        <div>
          <div class="business-name" style="margin-bottom:2px;">Raj Marketing Mysore</div>
          <div class="business-details">+91 94830 37385</div>
          <div class="business-address" style="margin-bottom:0;">#84, Nrupatunga Road, Kuvempu Nagar, Mysore, Karnataka, India</div>
        </div>
        <div>
          <span class="estimate-id" id="previewEstimateId"></span>
        </div>
      </div>
      <div class="preview-details" id="previewDetails"></div>
      <div id="previewTableBlock"></div>
      <div class="signatory">
        <span>Authorised Signatory</span><br>
        <img src="https://i.imgur.com/4M7IWwP.png" class="stamp" alt="Stamp" /><br>
        Raj Marketing Mysore
      </div>
      <button class="download-btn" id="downloadBtn">Download PDF</button>
    </div>
  </div>
  <footer>
    <div class="footer-links">
      <a href="https://wa.me/919483037385" class="whatsapp-btn" target="_blank">WhatsApp</a>
      <a href="mailto:rajmarketingmysore@gmail.com" class="email-btn" target="_blank">Email</a>
      <a href="privacy.html" class="footer-link" target="_blank">Privacy Policy</a>
      <a href="disclaimer.html" class="footer-link" target="_blank">Disclaimer</a>
      <a href="terms.html" class="footer-link" target="_blank">Terms</a>
    </div>
    <div style="color:#b8e0fd;font-size:0.98rem;">
      &copy; 2025 Raj Marketing Mysore. All rights reserved.
    </div>
  </footer>
  <script>
    // Hamburger menu logic
    const menuBtn = document.getElementById('menuBtn');
    const topNav = document.getElementById('topNav');
    menuBtn.addEventListener('click', () => {
      topNav.classList.toggle('open');
    });
    window.addEventListener('resize', () => {
      if (window.innerWidth > 850) topNav.classList.remove('open');
    });

    // Estimate ID auto increment logic
    function getNextEstimateNum() {
      let n = +(localStorage.getItem('estimate_number') || '0') + 1;
      localStorage.setItem('estimate_number', n);
      return n;
    }
    let currEstimateNum = getNextEstimateNum();
    function padEstimateId(num) {
      return num.toString().padStart(4, '0');
    }
    let estimateId = "Estimate - " + padEstimateId(currEstimateNum);
    document.getElementById('estimateIdBox').textContent = estimateId;

    // Customer ID: 7 char alphanumeric, auto
    function genCustomerId() {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      let id = "";
      for (let i = 0; i < 7; ++i) {
        id += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return id;
    }
    document.getElementById('customerId').value = genCustomerId();

    // Autofill today's date
    document.getElementById('date').valueAsDate = new Date();

    // Remove any example values from form - no values set

    // Net type/pricing logic
    const NET_PRICES = {
      "Velcro System": 60,
      "Frame System": 180,
      "Pleated Nets": 350,
      "Fly Mesh Door": 380
    };
    const netTypeSel = document.getElementById('netType');
    const pricePerSqft = document.getElementById('pricePerSqft');
    netTypeSel.addEventListener('change', function() {
      let v = netTypeSel.value;
      pricePerSqft.value = NET_PRICES[v] || '';
      updateTotals();
    });

    // Items Table Logic
    function addRow(w=24, h=48, q=1) {
      const tbody = document.getElementById('itemsTable').querySelector('tbody');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="number" min="1" value="${w}" onchange="updateTotals()"></td>
        <td><input type="number" min="1" value="${h}" onchange="updateTotals()"></td>
        <td><input type="number" min="1" value="${q}" onchange="updateTotals()"></td>
        <td class="sqft">0.00</td>
        <td class="price">0.00</td>
        <td><button type="button" onclick="this.closest('tr').remove();updateTotals()" style="background:var(--sky-mid);color:var(--blue-dark);border:none;padding:6px 10px;border-radius:6px;cursor:pointer;font-weight:600;">×</button></td>
      `;
      tbody.appendChild(tr);
      updateTotals();
    }
    document.getElementById('addRowBtn').onclick = () => addRow();

    // Start with one blank row
    addRow();

    function updateTotals() {
      const rows = document.querySelectorAll("#itemsTable tbody tr");
      const ppsqft = parseFloat(pricePerSqft.value) || 0;
      let totalSqft = 0, totalPrice = 0, totalQty = 0;
      rows.forEach(row => {
        let width = parseFloat(row.cells[0].querySelector('input').value) || 0;
        let height = parseFloat(row.cells[1].querySelector('input').value) || 0;
        const qty = parseFloat(row.cells[2].querySelector('input').value) || 0;
        // Apply rule: below 24" = 24"
        width = width < 24 ? 24 : width;
        height = height < 24 ? 24 : height;
        const sqft = (width * height * qty) / 144;
        const price = sqft * ppsqft;
        row.cells[3].innerText = sqft.toFixed(2);
        row.cells[4].innerText = price.toFixed(2);
        totalSqft += sqft;
        totalPrice += price;
        totalQty += qty;
      });
      document.getElementById("totals").innerHTML =
        `Total Qty: ${totalQty} &nbsp;|&nbsp; Total Sqft: ${totalSqft.toFixed(2)} &nbsp;|&nbsp; <span style="color:#1976d2">Total Estimate: ₹${totalPrice.toFixed(2)}</span>`;
    }
    window.updateTotals = updateTotals;

    // Estimate Preview & Save to Admin (localStorage)
    document.getElementById('genPreviewBtn').onclick = function() {
      if(!document.getElementById('estimateForm').reportValidity()) return;
      const customerName = document.getElementById('customerName').value.trim();
      const mobile = document.getElementById('mobileNumber').value.trim();
      const address = document.getElementById('address').value.trim();
      const date = document.getElementById('date').value;
      const customerId = document.getElementById('customerId').value.trim();
      const netType = netTypeSel.value;
      const ppsqft = pricePerSqft.value;
     // Table data
      let itemRows = '';
      let rows = document.querySelectorAll("#itemsTable tbody tr");
      let totalQty = 0, totalSqft = 0, totalPrice = 0;
      rows.forEach(row=>{
        let width = parseFloat(row.cells[0].querySelector('input').value) || 0;
        let height = parseFloat(row.cells[1].querySelector('input').value) || 0;
        const qty = parseFloat(row.cells[2].querySelector('input').value) || 0;
        width = width < 24 ? 24 : width;
        height = height < 24 ? 24 : height;
        const sqft = (width * height * qty) / 144;
        const price = sqft * ppsqft;
        totalQty += qty;
        totalSqft += sqft;
        totalPrice += price;
        itemRows += `<tr>
          <td>${width}</td><td>${height}</td><td>${qty}</td><td>${sqft.toFixed(2)}</td><td>₹${price.toFixed(2)}</td>
        </tr>`;
      });
      // Attractive Preview
      document.getElementById('previewEstimateId').textContent = estimateId;
      document.getElementById('previewDetails').innerHTML = `
        <div><b>Customer Name:</b> ${customerName}</div>
        <div><b>Mobile:</b> ${mobile}</div>
        <div><b>Address:</b> ${address}</div>
        <div><b>Date:</b> ${date}</div>
        <div><b>Customer ID:</b> ${customerId}</div>
        <div><b>Type of Product:</b> ${netType}</div>
        <div><b>Price per Sqft:</b> ₹${ppsqft}</div>
      `;
      document.getElementById('previewTableBlock').innerHTML = `
        <table style="width:100%;margin:13px 0 13px 0;font-size:0.99rem;border-collapse:collapse;" border="1">
          <thead>
            <tr>
              <th>Width (in)</th>
              <th>Height (in)</th>
              <th>Qty</th>
              <th>Total Sqft</th>
              <th>Price (₹)</th>
            </tr>
          </thead>
          <tbody>
            ${itemRows}
          </tbody>
        </table>
        <div style="margin-top:10px;font-size:1.08em;text-align:right;">
          <b>Total Qty:</b> ${totalQty} &nbsp; | &nbsp; <b>Total Sqft:</b> ${totalSqft.toFixed(2)} &nbsp; | &nbsp; <b>Total Estimate:</b> <span style="color:#18c964">₹${totalPrice.toFixed(2)}</span>
        </div>
      `;
      document.getElementById('previewBlock').style.display = '';
      // Save to admin (localStorage)
      let est = JSON.parse(localStorage.getItem('estimates')||'[]');
      est.push({
        estimateId, customerName, mobile, address, date, customerId, netType, ppsqft,
        items: Array.from(rows).map(row=>({
          width: row.cells[0].querySelector('input').value,
          height: row.cells[1].querySelector('input').value,
          qty: row.cells[2].querySelector('input').value,
          sqft: row.cells[3].innerText,
          price: row.cells[4].innerText
        })),
        totalQty, totalSqft: totalSqft.toFixed(2), totalPrice: totalPrice.toFixed(2),
        created: new Date().toLocaleString()
      });
      localStorage.setItem('estimates', JSON.stringify(est));
      window.scrollTo({top:document.getElementById('previewBlock').offsetTop-22,behavior:'smooth'});
    };

    // Download as PDF (using browser print)
    document.getElementById('downloadBtn').onclick = function() {
      document.body.classList.add('print-preview');
      document.getElementById('previewBlock').classList.add('print-preview');
      document.title = document.getElementById('previewEstimateId').textContent + " - Raj Marketing Mysore";
      window.print();
      setTimeout(()=>{
        document.body.classList.remove('print-preview');
        document.getElementById('previewBlock').classList.remove('print-preview');
        document.title = "Estimate | Raj Marketing Mysore";
      }, 600);
    };

    // Save admin on every change (optional: for auto-save)
    document.getElementById('estimateForm').addEventListener('input', ()=>{
      // Optionally, auto-save logic if you want
      // Disabled for performance unless required
    });
  </script>
</body>
</html>
